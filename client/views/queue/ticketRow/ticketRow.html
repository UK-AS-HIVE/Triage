<template name="ticketRow">
<tr data-toggle="collapse" data-target="#row{{_id}}" class="accordion-toggle ticket-row" data-ticket="{{_id}}">
  <td>
    <span class="glyphicon glyphicon-plus" name="{{_id}}"></span>
    {{#if repliedTo}}
    <span class="glyphicon glyphicon-comment"></span>
    {{/if}}
    {{#if hasAttachment}}
    <span class="glyphicon glyphicon-paperclip"></span>
    {{/if}}
  </td>
  <td>{{title}}</td>
  <td>{{authorName}}</td>
  <td>
    <div class="dropdown" data-ticket="{{_id}}">
      <button class="btn btn-default btn-xs dropdown-toggle" type="button" data-toggle="dropdown" name="statusButton" aria-expanded="false">{{status}}<span class="caret"></span></button>
      <ul class="dropdown-menu" name="statusMenu" role="menu" aria-labelledby="ticketStatusDropdown">
        <li role="presentation"><a role="menuitem" tabindex="-1">Open</a></li>
        <li role="presentation"><a role="menuitem" tabindex="-1">Closed</a></li>
        <li role="presentation" class="ticket-status-input"><input type="text" name="customStatus" placeholder="Or a custom status"></li>
      </ul>
    </div>
  </td>
  <td>{{>dateFormatter date=submittedTimestamp}}</td>
</tr>
<tr>
  <td colspan='5' class="hiddenRow">
    <div class="accordion-body collapse" id="row{{_id}}" data-ticket="{{_id}}">
      <div class="col-xs-12 col-md-12">
        <blockquote>
          {{body}}
        </blockquote>

        <div class="row">
          {{#if multiqueues}}
            This ticket is part of {{multiqueues}} queues.
          {{/if}}
        </div>

        <div class="row">
          <table class="table table-bordered">
            <thead>
              <tr>
                <th width="33%">Assigned Users</th>
                <th width="33%">Tags</th>
                <th width="33%">Attachments</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div class="assign-user-field">
                    <span class="icon glyphicon glyphicon-plus"></span>
                    <input type="text" name="assignUser" placeholder="Assign User" data-toggle="tooltip" data-trigger="manual" title="User not found.">
                  </div>
                  {{#each associatedUserIds}}
                  {{> associatedUserPortrait}}
                  {{/each}}
                </td>
                <td>
                  {{#each tags}}
                    {{> tag }}
                  {{/each}}
                </td>
                <td>
                  {{#each attachmentIds}}
                  <img style="max-width: 64px; max-height:24px;" src="/file/{{file.thumbnail}}" />
                  <a href="/file/{{file.filenameOnDisk}}">{{file.filename}}</a><br />
                  {{/each}}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        {{#each changelog}}
          {{#if note}}
            <div class="row">
              <div class="col-xs-4 col-md-2">
                <label for="note-{{_id}}" class="control-label pull-right">
                  {{> userPortrait userId=authorId}}
                  <small style="font-size: 0.7em; font-weight: lighter;">{{>timeParser date=timestamp}}</small>
                </label>
              </div>
              <div class="col-xs-8 col-md-10">
                <div class="well well-sm" style="text-align: left;">{{message}}</div>
              </div>
            </div>
          {{else}}
            <div class="row">
              <div class="col-xs-8 col-xs-offset-4 col-md-10 col-md-offset-2">
                {{#if changeIsType 'attachment'}}
                  {{#with otherId}}
                    <img style="max-width: 100%; max-height: 128px" src="/file/{{file.filenameOnDisk}}"/><br/>
                  {{/with}}
                  <small style="font-size: 0.7em;">User {{authorName}} {{message}} @ {{timestamp}}</small>
                {{else}}
                  <small style="font-size: 0.7em;">User {{authorName}} {{message}} @ {{timestamp}}</small>
                {{/if}}
              </div>
            </div>
          {{/if}}
        {{/each}}

        <div class="form-group">
          <div class="col-xs-12 col-md-10 col-md-offset-2">
            <div class="input-group">
              {{> inputAutocomplete name="newNote" class="form-control" placeholder="Add a new note..." settings=settings }}
              <div class="input-group-btn">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-expanded="False">Attach File <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                  <li><a data-action="uploadFile">Upload File</a></li>
                  <li><a href="#">Take Picture</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="hidden-xs col-md-12">
        {{#each arrayify formFields}}
        {{>tableFormGroup name=name value=value disabled="disabled"}}
        {{/each}}
      </div>
    </div>
  </td>
</tr>
</template>
